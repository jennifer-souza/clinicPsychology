"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var declarations_1 = require("../declarations");
var utils_1 = require("../internals/utils");
function Table(tableName, opts) {
    return function (target) {
        target.tableName = tableName;
        var joinMeta = utils_1.getMeta(target, declarations_1.META_ANN_JOIN);
        var oldMappings = target.relationMappings;
        target.relationMappings = function () { return Object.assign({}, oldMappings, Object.entries(joinMeta).reduce(function (prv, _a) {
            var _b;
            var key = _a[0], metaFn = _a[1];
            return (tslib_1.__assign({}, prv, (_b = {}, _b[key] = metaFn(), _b)));
        }, {})); };
        if (!target.jsonSchema) {
            target.jsonSchema = {
                type: 'object',
                properties: {},
            };
        }
        utils_1.appendMeta(target, declarations_1.META_ANN_SCHEMA, opts);
    };
}
exports.Table = Table;
